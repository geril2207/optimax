(this["webpackJsonpvirtual-mirror"]=this["webpackJsonpvirtual-mirror"]||[]).push([[0],{17:function(e,t,a){e.exports={loader:"Loader_loader__1pt1x",load3:"Loader_load3__3uxaJ"}},23:function(e,t,a){},30:function(e,t,a){"use strict";a.r(t);var n=a(1),c=a.n(n),s=a(10),r=a.n(s),i=(a(23),a(2)),o=a.p+"static/media/photo.64b7054a.png",l=a(7),d=a.n(l),_=a(5),j=a(15),u=a.n(j),b=a(14),m=a.n(b),h=a(16),p="FETCH_TODO_SUCCESS",O="SET_MAIN_ITEM",x="SET_LOADING",f="SET_PHOTO_CONDITION",g="UPLOAD_IMAGE",y="SET_PD",v="SET_PHOTOSIZE",N="SET_PHOTO_ROTATION",S="SET_LEFT_MARK",k="SET_RIGHT_MARK",w="SET_DEFAULT",M=function(e){return{type:f,payload:e}},T=function(e){return{type:x,payload:e}},E=a(0),R=function(){var e=c.a.useRef(null),t=c.a.useState(""),a=Object(_.a)(t,2),n=a[0],s=a[1],r=Object(i.b)(),o=c.a.useCallback((function(){var t=e.current.getScreenshot();r({type:g,payload:t})}),[e]);return c.a.useEffect((function(){navigator.permissions.query({name:"camera"}).then((function(e){s(e.state)}))}),[]),Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(u.a,{className:"webcam__screen",audio:!1,ref:e,width:444,screenshotFormat:"image/jpeg",onUserMedia:function(){s("granted"),r(M(2))},onUserMediaError:function(e){s("denied")}}),"prompt"===n?Object(E.jsxs)("div",{className:"webcam__confirm_container",children:[Object(E.jsx)("h3",{children:"Allow camera access"}),Object(E.jsx)("h4",{children:"We ask you to enable camera access so you can start trying on glasses."})]}):"granted"===n?Object(E.jsx)(z,{func:o}):"denied"===n&&Object(E.jsxs)("div",{className:"webcam__confirm_container",children:[Object(E.jsx)("h3",{children:"Something went wrong"}),Object(E.jsx)("h4",{children:"Maybe you denied access to your camera"})]})]})},I=function(){var e=Object(i.c)((function(e){return e.photo})),t=e.image,a=e.pd,s=e.photoSize,r=e.photoRotation,o=e.leftMark,l=e.rightMark,d=Object(i.c)((function(e){return e.glasses.items[e.glasses.mainItem]})),j=c.a.useRef(),u=Object(n.useState)(1),b=Object(_.a)(u,2),m=b[0],h=b[1],p={x:(l.x+o.x)/2,y:(l.y+o.y)/2},O=180*Math.atan((l.y-o.y)/(l.x-o.x))/Math.PI;return Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("img",{className:"webcam__screen",style:{transform:"scale(".concat(s,") rotate(").concat(r,"deg)")},src:t,alt:""}),Object(E.jsx)("img",{src:d.mirror_frame,style:{position:"absolute",transform:"translate(-50%, -50%) rotate(".concat(O,"deg)  scale(").concat(m,") "),top:"".concat(p.y,"px"),left:"".concat(p.x,"px")},ref:j,alt:"",className:"webcam__glasses",onLoad:function(){var e=d.width/j.current.offsetWidth/(a/Math.sqrt(Math.pow(l.x-o.x,2)+Math.pow(l.y-o.y,2)));h(e)}})]})};function C(e,t,a,n,c){var s=a?a.current.getBoundingClientRect():{x:31,y:48};function r(e){var t=e.clientX-Math.round(s.x),a=e.clientY-Math.round(s.y);t&&a&&("right"===c?n(function(e,t){return{type:k,payload:{x:e,y:t,type:"right"}}}(t,a)):"left"===c&&n(function(e,t){return{type:S,payload:{x:e,y:t,type:"left"}}}(t,a)))}t.current.ondragstart=function(){return!1},r(e),document.onmousemove=function(e){r(e)}}function D(e){document.onmousemove=null,e.current.onmouseup=null}var A=function(){var e=Object(i.c)((function(e){return e.photo})),t=e.condition,a=e.image,n=e.photoSize,s=e.photoRotation,r=e.leftMark,l=e.rightMark,_=c.a.useRef(),j=c.a.useRef(),u=Object(i.b)(),b=c.a.useRef();return Object(E.jsxs)("div",{className:d()("photo__container"),ref:b,children:[0===t?Object(E.jsx)("img",{src:o,alt:""}):1===t||2===t?Object(E.jsx)(R,{}):3===t?Object(E.jsxs)("div",{className:"webcam__container",children:[Object(E.jsx)("img",{className:"webcam__screen",style:{transform:"scale(".concat(n,") rotate(").concat(s,"deg)")},src:a,alt:""}),Object(E.jsx)("div",{draggable:!0,onMouseDown:function(e){return C(e,_,b,u,"left")},onMouseUp:function(){return D(_)},style:{top:"".concat(r.y,"px"),left:"".concat(r.x,"px")},className:"mark left__mark",ref:_}),Object(E.jsx)("div",{draggable:!0,onMouseDown:function(e){return C(e,j,b,u,"right")},onMouseUp:function(){return D(j)},className:"mark right__mark",style:{top:"".concat(l.y,"px"),left:"".concat(l.x,"px")},ref:j})]}):4===t&&Object(E.jsx)("div",{className:"webcam__container",children:Object(E.jsx)(I,{})}),1!==t&&2!==t&&Object(E.jsx)(z,{})]})},U=a(9),P=a.n(U),L=a.p+"static/media/btn-prev.7600f6ec.svg",z=function(e){var t=e.func,a=Object(i.c)((function(e){return e.photo.condition})),n=Object(i.b)();return 1===a?Object(E.jsx)("div",{className:P.a.hidden}):Object(E.jsxs)("button",{className:P.a.btn,onClick:function(){return 3===a?n(M(a-1)):4===a?n(M(a-2)):(t&&t(),n(M(a+1)))},children:[Object(E.jsx)("img",{className:P.a.img,src:L,alt:""}),Object(E.jsx)("span",{className:P.a.text,children:["Upload","","Take a photo","Retake","Retake"][a]})]})},F=a(17),B=a.n(F),G=function(){return Object(E.jsx)("div",{className:B.a.loader})},H=a(8),W=a.p+"static/media/arrow_left.dc4cf9ed.svg",J=a(4),q=a.n(J),K=function(e){var t=e.elem,a=e.index,n=e.itemWidth,c=Object(i.b)();return Object(E.jsxs)("div",{className:q.a.slider__item,style:{minWidth:n},onClick:function(){c({type:O,payload:a})},children:[Object(E.jsx)("img",{className:q.a.slider__item_img,src:t.image,alt:""}),Object(E.jsx)("h4",{className:q.a.slider__item_title,children:t.name})]})},X=function(e){var t=e.items,a=Object(i.c)((function(e){return e.photo.condition})),n=Object(i.c)((function(e){return e.glasses.mainItem})),s=c.a.useState(660),r=Object(_.a)(s,2),o=r[0],l=r[1],j=c.a.useRef(),u=t.length-1,b=3,m=1,h=c.a.useState(0),p=Object(_.a)(h,2),O=p[0],x=p[1],f=o/b,g=m*f,y=function(){return O<=-(u-b)*f},v=function(){return 0===O},N=Object(i.b)();return c.a.useEffect((function(){3!==a&&l(j.current.offsetWidth)}),[]),3===a?Object(E.jsxs)("div",{children:[Object(E.jsx)("button",{className:q.a.try__btn,onClick:function(){N(M(4))},children:"Try on Glasses"}),Object(E.jsx)("span",{onClick:function(){N({type:w})},className:q.a.reset__btn,children:"Reset Adjastments"})]}):Object(E.jsxs)("div",{className:q.a.slider,children:[Object(E.jsx)("h3",{className:q.a.slider__title,children:"Similar Frames"}),Object(E.jsx)("div",{className:q.a.slider__wrapper,ref:j,children:Object(E.jsx)("div",{className:q.a.slider__track,style:{transform:"translateX(".concat(O,"px)")},children:t&&t.map((function(e,t){return t!==n&&Object(E.jsx)(K,{index:t,elem:e,itemWidth:f},t)}))})}),Object(E.jsxs)("div",{className:q.a.slider__btns,children:[Object(E.jsx)("div",{className:q.a.slider__btn,onClick:function(){v()||x(O+g)},children:Object(E.jsx)("img",{className:d()(q.a.slider__prev,Object(H.a)({},q.a.slider__btn_disabled,!!v())),src:W,alt:""})}),Object(E.jsx)("div",{className:q.a.slider__btn,onClick:function(){y()||x(O-g)},children:Object(E.jsx)("img",{className:d()(q.a.slider__next,Object(H.a)({},q.a.slider__btn_disabled,!!y())),src:W,alt:""})})]})]})},Y=a.p+"static/media/pd.c5b3115c.svg",V=function(){var e=Object(i.c)((function(e){return e.photo})),t=e.pd,a=e.photoSize,n=e.photoRotation;function c(e){var t=e.target.value;switch(e.target.name){case"pd":return s(function(e){return{type:y,payload:e}}(t));case"photoSize":return s(function(e){return{type:v,payload:e}}(t));case"photoRotation":return s(function(e){return{type:N,payload:e}}(t))}}var s=Object(i.b)();return Object(E.jsxs)("div",{className:"rightbar editor",children:[Object(E.jsxs)("div",{className:"editor__back",onClick:function(){s(M(0))},children:[Object(E.jsx)("img",{className:"editor__back_arrow",src:W,alt:""}),"Back"]}),Object(E.jsx)("h3",{className:"editor__title",children:"Adjust the Image"}),Object(E.jsxs)("div",{className:"editor__instructions",children:[Object(E.jsx)("div",{className:"editor__instruction",children:Object(E.jsxs)("h5",{className:"editor__instruction_title",children:[Object(E.jsx)("strong",{children:"1. "})," ",Object(E.jsx)("span",{children:"Drag the RED targets to the center of your eyes."})]})}),Object(E.jsx)("div",{className:"editor__instruction",children:Object(E.jsxs)("h5",{className:"editor__instruction_title",children:[Object(E.jsx)("strong",{children:"2. "})," Drag to reposition photo"]})}),Object(E.jsxs)("div",{className:"editor__instruction",children:[Object(E.jsxs)("h5",{className:"editor__instruction_title",children:[Object(E.jsx)("strong",{children:"3. "})," Set your PD, if you know it.",Object(E.jsx)("img",{className:"editor__instruction_pd_img",src:Y,alt:""})]}),Object(E.jsx)("input",{className:"editor__pd",type:"text",value:t,name:"pd",onChange:c})]}),Object(E.jsxs)("div",{className:"editor__instruction",children:[Object(E.jsxs)("h5",{className:"editor__instruction_title",children:[Object(E.jsx)("strong",{children:"4. "})," Adjust the photo with the controls."]}),Object(E.jsx)("h5",{className:"editor__instruction_subtitle",children:"Photo size:"}),Object(E.jsx)("input",{className:"editor__input_range",type:"range",min:"0.5",max:"1.5",step:"0.1",value:a,name:"photoSize",onChange:c}),Object(E.jsx)("h5",{className:"editor__instruction_subtitle",children:"Photo rotation: "}),Object(E.jsx)("input",{className:"editor__input_range",type:"range",min:"-180",max:"180",step:"5",value:n,name:"photoRotation",onChange:c})]})]})]})},Z=function(e){var t=e.item;return Object(E.jsxs)("div",{className:"rightbar",children:[Object(E.jsx)("h3",{className:"glasses__title",children:t.name}),Object(E.jsx)("img",{src:t.image,alt:"\u041e\u0447\u043a\u0438",className:"glasses__img"}),Object(E.jsx)("button",{className:"glasses__btn",children:"Choose Lenses"}),Object(E.jsxs)("div",{className:"glasses__about",children:[Object(E.jsx)("div",{className:"glasses__about_title",children:"Product Description"}),Object(E.jsx)("p",{className:"glasses__about_description",children:t.description})]})]})},Q=function(e){var t=e.item;return 3===Object(i.c)((function(e){return e.photo.condition}))?Object(E.jsx)(V,{}):Object(E.jsx)(Z,{item:t})};var $=function(){var e=Object(i.b)(),t=Object(i.c)((function(e){return e.glasses})),a=Object(i.c)((function(e){return e.glasses.loading}));return Object(n.useEffect)((function(){e(function(){var e=Object(h.a)(m.a.mark((function e(t){var a,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(T(!0)),e.next=3,fetch("https://optimaxdev.github.io/volga-it/response.json");case 3:return a=e.sent,e.next=6,a.json();case 6:n=e.sent,t({type:p,payload:n}),t(T(!1));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]),a||!t.items.length?Object(E.jsx)("div",{className:"virtual__mirror_container flex__mirror_container",children:Object(E.jsx)(G,{})}):Object(E.jsxs)("div",{className:"virtual__mirror_container",children:[Object(E.jsxs)("div",{className:"container__header",children:[Object(E.jsx)(A,{}),Object(E.jsx)(Q,{item:t.items[t.mainItem]})]}),Object(E.jsx)(X,{items:t.items})]})},ee=a(6),te=a(18),ae=a(3),ne={mainItem:0,loading:!1,items:[]},ce=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ne,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:return Object(ae.a)(Object(ae.a)({},e),{},{mainItem:t.payload});case x:return Object(ae.a)(Object(ae.a)({},e),{},{loading:t.payload});case p:return Object(ae.a)(Object(ae.a)({},e),{},{items:t.payload.items});default:return e}},se={condition:0,image:"",pd:"62",photoSize:1,photoRotation:0,leftMark:{x:135,y:175,type:"left"},rightMark:{x:270,y:175,type:"right"}},re=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case w:return Object(ae.a)(Object(ae.a)({},e),{},{pd:"62",photoSize:1,photoRotation:0,leftMark:{x:135,y:175,type:"left"},rightMark:{x:270,y:175,type:"right"}});case y:return Object(ae.a)(Object(ae.a)({},e),{},{pd:t.payload});case v:return Object(ae.a)(Object(ae.a)({},e),{},{photoSize:t.payload});case N:return Object(ae.a)(Object(ae.a)({},e),{},{photoRotation:t.payload});case S:return Object(ae.a)(Object(ae.a)({},e),{},{leftMark:t.payload});case k:return Object(ae.a)(Object(ae.a)({},e),{},{rightMark:t.payload});case f:return Object(ae.a)(Object(ae.a)({},e),{},{condition:t.payload});case g:return Object(ae.a)(Object(ae.a)({},e),{},{image:t.payload});default:return e}},ie=Object(ee.b)({glasses:ce,photo:re}),oe=Object(ee.d)(ie,Object(ee.c)(Object(ee.a)(te.a)));r.a.render(Object(E.jsx)(c.a.StrictMode,{children:Object(E.jsx)(i.a,{store:oe,children:Object(E.jsx)($,{})})}),document.getElementById("virtual-mirror-widget"))},4:function(e,t,a){e.exports={slider__next:"Slider_slider__next__39osm",slider:"Slider_slider__3mt_G",slider__title:"Slider_slider__title__CskKE",slider__wrapper:"Slider_slider__wrapper__olPVI",slider__track:"Slider_slider__track__7TXvL",slider__item:"Slider_slider__item__2ECx_",slider__prev:"Slider_slider__prev__1HGp-",slider__btn_img:"Slider_slider__btn_img__1bfem",slider__item_img:"Slider_slider__item_img__3au6t",slider__item_title:"Slider_slider__item_title__62SiY",slider__btn_disabled:"Slider_slider__btn_disabled__2ep99",try__btn:"Slider_try__btn__2eT-U",reset__btn:"Slider_reset__btn__2JRHG"}},9:function(e,t,a){e.exports={btn:"UploadBtn_btn__kAIjr",text:"UploadBtn_text__2FDkw",img:"UploadBtn_img__1Le4p",hidden:"UploadBtn_hidden__3q-Iu"}}},[[30,1,2]]]);
//# sourceMappingURL=main.ed83bd9b.chunk.js.map